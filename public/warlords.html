<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Warlords – Canyon Siege (Arcade Vector)</title>

<style>
html,body{
  margin:0;
  height:100%;
  background:#000;
  overflow:hidden;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  -webkit-tap-highlight-color:transparent;
}

/* Portrait arcade playfield */
.stage{
  width:100vw;
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#000;
}

svg{
  width:100%;
  height:100%;
  display:block;
}

/* Classic arcade vector look */
.vector{
  stroke:#ffffff;
  stroke-width:5.5;
  stroke-linecap:round;
  stroke-linejoin:round;
  fill:none;
  filter:url(#glow);
}

.thin{
  stroke-width:3;
}

/* Cannonballs */
.cannonball{
  fill:#fff;
}

/* Explosion particles */
.particle{
  fill:#fff;
}

/* Tap-to-start overlay */
#sound-enable{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:10;
}

#sound-enable .box{
  color:#fff;
  border:2px solid #444;
  padding:14px 22px;
  border-radius:10px;
  background:rgba(0,0,0,.75);
  font-size:16px;
  text-align:center;
}

.hidden{display:none}
.label{
  position:fixed;
  bottom:10px;
  left:10px;
  color:#777;
  font-size:12px;
}
</style>
</head>

<body>
<div class="stage" id="stage">

<svg id="scene" viewBox="0 0 720 1280" preserveAspectRatio="xMidYMid slice">

<!-- VECTOR GLOW FILTER -->
<defs>
  <filter id="glow">
    <feGaussianBlur stdDeviation="2" result="blur"/>
    <feMerge>
      <feMergeNode in="blur"/>
      <feMergeNode in="SourceGraphic"/>
    </feMerge>
  </filter>
</defs>

<!-- LEFT MOUNTAIN WALL (layered & jagged) -->
<path class="vector"
d="
M 0 40
L 40 80
L 20 160
L 80 220
L 60 320
L 120 380
L 90 520
L 180 620
L 140 760
L 240 900
L 200 1100
L 300 1280
"/>

<!-- RIGHT MOUNTAIN WALL -->
<path class="vector"
d="
M 720 40
L 680 80
L 700 160
L 640 220
L 660 320
L 600 380
L 630 520
L 540 620
L 580 760
L 480 900
L 520 1100
L 420 1280
"/>

<!-- CANYON DEPTH LINES -->
<path class="vector thin" d="M 360 880 L 350 1040 L 340 1280"/>
<path class="vector thin" d="M 380 880 L 390 1040 L 400 1280"/>

<!-- LEFT CASTLE (multi-tower keep) -->
<g id="castle-left" transform="translate(130,190)">
  <!-- main keep -->
  <rect x="-30" y="40" width="60" height="90" class="vector"/>
  <!-- battlements -->
  <path class="vector thin" d="M -30 40 L -30 28 L -20 28 L -20 40
                               L -8 40 L -8 28 L 2 28 L 2 40
                               L 14 40 L 14 28 L 24 28 L 24 40"/>
  <!-- tower -->
  <rect x="40" y="10" width="28" height="120" class="vector"/>
  <path class="vector thin" d="M 40 10 L 40 -4 L 52 -4 L 52 10 L 68 10"/>
  <!-- gate -->
  <path class="vector thin" d="M -10 130 L -10 160 L 10 160 L 10 130"/>
  <!-- cannon -->
  <rect x="68" y="58" width="30" height="8" class="vector"/>
</g>

<!-- RIGHT CASTLE -->
<g id="castle-right" transform="translate(590,190)">
  <rect x="-30" y="40" width="60" height="90" class="vector"/>
  <path class="vector thin" d="M -30 40 L -30 28 L -20 28 L -20 40
                               L -8 40 L -8 28 L 2 28 L 2 40
                               L 14 40 L 14 28 L 24 28 L 24 40"/>
  <rect x="-68" y="10" width="28" height="120" class="vector"/>
  <path class="vector thin" d="M -68 10 L -68 -4 L -56 -4 L -56 10 L -40 10"/>
  <path class="vector thin" d="M -10 130 L -10 160 L 10 160 L 10 130"/>
  <rect x="-98" y="58" width="30" height="8" class="vector"/>
</g>

<!-- PROJECTILE PATHS -->
<path id="path-left-to-right"
d="M 198 248 Q 360 60 522 248"
fill="none"/>

<path id="path-right-to-left"
d="M 522 248 Q 360 60 198 248"
fill="none"/>

<!-- CANNONBALLS -->
<circle id="ball-left" class="cannonball" r="7" cx="-20" cy="-20" visibility="hidden"/>
<circle id="ball-right" class="cannonball" r="7" cx="-20" cy="-20" visibility="hidden"/>

<!-- EXPLOSIONS -->
<g id="expl-left" visibility="hidden"></g>
<g id="expl-right" visibility="hidden"></g>

</svg>
</div>

<div id="sound-enable">
  <div class="box" id="enable-box">TAP TO START · CLASSIC ARCADE MODE</div>
</div>

<div class="label">Vector Siege · Cannon volleys every 10s</div>

<script>
/* === GAME LOGIC (unchanged, cleaned) === */
(() => {

const INTERVAL = 10000;
const TRAVEL = 2000;

const pathLR = document.getElementById('path-left-to-right');
const pathRL = document.getElementById('path-right-to-left');
const ballL = document.getElementById('ball-left');
const ballR = document.getElementById('ball-right');
const explL = document.getElementById('expl-left');
const explR = document.getElementById('expl-right');

const lenLR = pathLR.getTotalLength();
const lenRL = pathRL.getTotalLength();

let audioCtx=null, timer=null;

function audio(){
  if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
}

function boom(freq){
  audio();
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.frequency.value=freq;
  o.type='sawtooth';
  g.gain.setValueAtTime(.8,audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(.001,audioCtx.currentTime+.6);
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+.6);
}

function animate(ball,path,len){
  return new Promise(r=>{
    let s=null;
    ball.setAttribute("visibility","visible");
    function step(t){
      if(!s) s=t;
      let f=Math.min(1,(t-s)/TRAVEL);
      let p=path.getPointAtLength(f*len);
      ball.setAttribute("cx",p.x);
      ball.setAttribute("cy",p.y);
      f<1?requestAnimationFrame(step):(ball.setAttribute("visibility","hidden"),r());
    }
    requestAnimationFrame(step);
  });
}

function explode(group,x,y){
  group.innerHTML="";
  group.setAttribute("visibility","visible");
  for(let i=0;i<14;i++){
    let c=document.createElementNS("http://www.w3.org/2000/svg","circle");
    c.setAttribute("cx",x);
    c.setAttribute("cy",y);
    c.setAttribute("r",2+Math.random()*3);
    c.classList.add("particle");
    group.appendChild(c);
  }
  setTimeout(()=>group.setAttribute("visibility","hidden"),800);
}

async function volley(){
  boom(80);
  const p1=animate(ballL,pathLR,lenLR);
  const p2=animate(ballR,pathRL,lenRL);
  setTimeout(()=>explode(explR,522,248),TRAVEL-40);
  setTimeout(()=>explode(explL,198,248),TRAVEL-40);
  await Promise.all([p1,p2]);
}

function start(){
  volley();
  timer=setInterval(volley,INTERVAL);
}

document.getElementById("enable-box").onclick=()=>{
  audio(); audioCtx.resume();
  document.getElementById("sound-enable").classList.add("hidden");
  if(!timer) start();
};

})();
</script>
</body>
</html>
